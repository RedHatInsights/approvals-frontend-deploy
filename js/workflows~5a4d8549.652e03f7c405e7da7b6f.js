(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{722:function(e,t,a){"use strict";var r=(0,a(193).defineMessages)({createApprovalTitle:{id:"formMessages.createApprovalTitle",defaultMessage:"Create approval process"},generalInformation:{id:"formMessages.generalInformation",defaultMessage:"General information"},setGroups:{id:"formMessages.setGroups",defaultMessage:"Set groups"},enterInfo:{id:"formMessages.enterInfo",defaultMessage:"Enter your information"},approvalProcessName:{id:"formMessages.approvalProcessName",defaultMessage:"Name"},enterApprovalName:{id:"formMessages.enterApprovalName",defaultMessage:"Enter a name for the approval process"},description:{id:"formMessages.description",defaultMessage:"Description"},nameTaken:{id:"formMessages.nameTaken",defaultMessage:"Name has already been taken"},selectPlaceholder:{id:"formMessages.selectPlaceholder",defaultMessage:"Select..."},summary:{id:"formMessages.summary",defaultMessage:"Summary"},groups:{id:"formMessages.groups",defaultMessage:"Groups"},create:{id:"formMessages.create",defaultMessage:"Create"}});t.a=r},794:function(e,t,a){"use strict";a.r(t);var r=a(197),s=a.n(r),n=a(87),o=a.n(n),c=a(11),i=a.n(c),l=a(0),u=a.n(l),f=a(107),p=a(16),d=a(66),m=a(203),g=a(202),v=a(194),w=a(670),b=a.n(w),h=a(283),M=a(76),y=a(14),k=a(99),O=a.n(k),P=a(153),E=a.n(P),j=a(198),S=a(195),D=a(89),T=Object(j.f)(),F=Object(j.e)();function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.a,a=arguments.length>2?arguments[2]:void 0,r="&limit=".concat(Math.max(t.limit,10),"&offset=").concat(t.offset),s="&filter[name][contains_i]=".concat(e),n=a?"&sort_by=".concat(a.property,":").concat(a.direction):"";return Object(j.b)().get("".concat(D.a,"/workflows/?").concat(s).concat(r).concat(n))}var A=function(e){return T.showWorkflow(e)};function R(e){return _.apply(this,arguments)}function _(){return(_=E()(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.destroyWorkflow(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return C.apply(this,arguments)}function C(){return(C=E()(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(){var e=E()(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.destroyWorkflow(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=(0,a(193).defineMessages)({edit:{id:"worfklowMessages.edit",defaultMessage:"Edit"},editInformation:{id:"worfklowMessages.editInformation",defaultMessage:"Edit information"},deleteApprovalTitle:{id:"worfklowMessages.deleteApprovalTitle",defaultMessage:"Delete approval process"},approvalProcess:{id:"worfklowMessages.approvalProcess",defaultMessage:"approval process"},approvalProcesses:{id:"worfklowMessages.approvalProcesses",defaultMessage:"approval processes"},noApprovalProcesses:{id:"worfklowMessages.noApprovalProcesses",defaultMessage:"No approval processes"},sequence:{id:"workflowMessages.sequence",defaultMessage:"Sequence"},enterSequence:{id:"workflowMessages.enterSequence",defaultMessage:"Enter sequence"},removeProcessTitle:{id:"workflowMessages.removeProcessTitle",defaultMessage:"Delete {count, plural, one {approval process} other {approval processes}}?"},removeProcessAriaLabel:{id:"workflowMessages.removeProcessTitle",defaultMessage:"Delete {count, plural, one {approval process} other {approval processes}} modal"},removeProcessDescription:{id:"workflowMessages.removeProcessDescription",defaultMessage:"{name} will be removed."},removeProcessDescriptionWithDeps:{id:"workflowMessages.removeProcessDescriptionWithDeps",defaultMessage:"{name} will be removed from the following applications: {dependenciesList}"},editProcessTitle:{id:"workflowMessages.editProcessTitle",defaultMessage:"Make any changes to approval process {name}"},addProcessSuccessTitle:{id:"workflowMessages.addProcessSuccessTitle",defaultMessage:"Success adding approval process"},addProcessSuccessDescription:{id:"workflowMessages.addProcessSuccessDescription",defaultMessage:"The approval process was added successfully."},updateProcessSuccessTitle:{id:"workflowMessages.updateProcessSuccessTitle",defaultMessage:"Success updating approval process"},updateProcessSuccessDescription:{id:"workflowMessages.updateProcessSuccessDescription",defaultMessage:"The approval process was updated successfully."},removeProcessSuccessTitle:{id:"workflowMessages.removeProcessSuccessTitle",defaultMessage:"Success removing approval process"},removeProcessSuccessDescription:{id:"workflowMessages.removeProcessSuccessDescription",defaultMessage:"The approval process was removed successfully."},removeProcessesSuccessTitle:{id:"workflowMessages.removeProcessesSuccessTitle",defaultMessage:"Success removing approval processes"},removeProcessesSuccessDescription:{id:"workflowMessages.removeProcessesSuccessDescription",defaultMessage:"The selected approval processes were removed successfully."}}),N=function(e){return function(t,a){var r=a().workflowReducer,s=r.sortBy,n=r.workflows,o=r.filterValue,c=e;if(!e&&n){var i=n.meta;c={limit:i.limit,offset:i.offset}}return t({type:y.j,payload:x(o,c,s)})}},I=function(e){return{type:y.o,payload:e}},L=a(199),B=a.n(L),W=a(264),G=a(668),z=a(52),U=a(728),X=a(108),J=a.n(X),Q=a(718),H=a.n(Q),K=a(725),Y=a.n(K),Z=a(735),$=a(722),ee=Object(Z.a)((function(e,t,a){return function(e){return x(e)}(e).then((function(r){var s=r.data;if(t?s.find((function(a){return e===a.name&&t!==a.id})):s.find((function(t){return e===t.name})))throw a.formatMessage($.a.nameTaken)}))})),te=function(e,t){return[{component:H.a.TEXT_FIELD,name:"name",isRequired:!0,id:"workflow-name",label:e.formatMessage($.a.approvalProcessName),validate:[function(a){return ee(a,t,e)},{type:Y.a.REQUIRED,message:e.formatMessage($.a.enterApprovalName)}]},{component:H.a.TEXTAREA,name:"description",id:"workflow-description",label:e.formatMessage($.a.description)}]},ae=Object(Z.a)((function(e){var t="&name=".concat(e);return Object(j.b)().get("".concat(D.c,'/groups/?role_names=",Approval Administrator,Approval Approver,"\n  ').concat(e&&e.length>0?t:"")).then((function(e){var t=e.data;return t&&t.length>0?t.map((function(e){var t=e.uuid;return{label:e.name,value:t}})):void 0}))})),re=function(e){return{component:H.a.SELECT,name:"group_refs",label:e.formatMessage($.a.setGroups),loadOptions:ae,noValueUpdates:!0,isMulti:!0,isSearchable:!0,simpleValue:!1,menuIsPortal:!0,isClearable:!0,placeholder:e.formatMessage($.a.selectPlaceholder)}},se=function(e){return{component:H.a.TEXT_FIELD,name:"sequence",label:e.formatMessage(V.enterSequence),isRequired:!0,validate:[{type:Y.a.REQUIRED}]}},ne=function(e,t){return{fields:[].concat(J()(te(e,t)),[re(e)],J()(t?[se(e)]:[]))}};function oe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ie=function(){var e=Object(f.useDispatch)(),t=Object(p.g)().push,a=Object(W.a)(),r=function(){return t(z.a.workflows.index)};return u.a.createElement(G.Modal,{isOpen:!0,onClose:r,title:a.formatMessage($.a.createApprovalTitle),variant:"small"},u.a.createElement(U.a,{onSubmit:function(r){var s=r.group_refs,n=void 0===s?[]:s,o=B()(r,["group_refs"]);return t(z.a.workflows.index),e(function(e,t){return{type:y.a,payload:(a=e,F.listTemplates().then((function(e){var t=e.data;if(!t[0])throw new Error("No template exists");return t[0].id})).then((function(e){return T.addWorkflowToTemplate(e,a,{})}))),meta:{notifications:{fulfilled:{variant:"success",title:t.formatMessage(V.addProcessSuccessTitle),description:t.formatMessage(V.addProcessSuccessDescription)}}}};var a}(ce(ce({},o),{},{group_refs:n.length>0?n.map((function(e){return{name:e.label,uuid:e.value}})):[]}),a)).then((function(){return e(N())}))},onCancel:r,schema:ne(a),disableSubmit:["validating"]}))},le=a(8),ue=a.n(le),fe=a(65),pe=a(106),de=a(706),me=a(667),ge=a(705),ve=a.n(ge),we=a(721),be=function(e){var t=Object(f.useSelector)((function(e){return{workflows:e.workflowReducer.workflows}}),f.shallowEqual).workflows;return t&&t.data&&t.data.find((function(t){return t.id===e}))},he=a(90),Me=a(720),ye=a(753),ke=a.n(ye),Oe=function(e){var t=e.ids,a=void 0===t?[]:t,r=e.fetchData,s=e.setSelectedWorkflows,n=Object(f.useDispatch)(),c=Object(l.useState)(),i=o()(c,2),d=i[0],m=i[1],g=Object(l.useState)(!1),w=o()(g,2),b=w[0],h=w[1],M=Object(p.g)().push,k=Object(we.a)(["workflow"]),O=o()(k,1)[0].workflow||1===a.length&&a[0],P=Object(W.a)(),E=be(O);if(Object(l.useEffect)((function(){var e;O&&!E&&n((e=O,{type:y.i,payload:A(e)})).then((function(e){var t=e.value;return m(t)})).catch((function(){return M(z.a.workflows.index)}))}),[]),!O&&0===a.length)return null;var j=function(){return n(O?function(e,t){return{type:y.k,payload:R(e),meta:{notifications:{fulfilled:{variant:"success",title:t.formatMessage(V.removeProcessSuccessTitle),description:t.formatMessage(V.removeProcessSuccessDescription)}}}}}(O,P):function(e,t){return{type:y.l,payload:q(e),meta:{notifications:{fulfilled:{variant:"success",title:t.formatMessage(V.removeProcessesSuccessTitle),description:t.formatMessage(V.removeProcessesSuccessDescription)}}}}}(a,P)).catch((function(){return h(!1)})).then((function(){return M(z.a.workflows.index)})).then((function(){return s([])})).then((function(){return r()}))},S=function(){return M(z.a.workflows.index)},T=function(){var e=E||d;return e&&!ke()(e)&&e.metadata&&e.metadata.object_dependencies&&!ke()(e.metadata.object_dependencies)?Object.keys(e.metadata.object_dependencies).reduce((function(e,t){return[].concat(J()(e),["".concat(D.b[t]||t)])}),[]):[]},F=u.a.createElement("b",{key:"remove-key"},O?d&&d.name||E&&E.name:u.a.createElement(u.a.Fragment,null,a.length," ",P.formatMessage(V.approvalProcesses))),x=O&&!E&&!d;return u.a.createElement(G.Modal,{isOpen:!0,variant:"small","aria-label":P.formatMessage(V.removeProcessAriaLabel,{count:O?1:a.length}),header:u.a.createElement(me.Title,{size:"2xl",headingLevel:"h1"},u.a.createElement(ve.a,{size:"sm",fill:"#f0ab00",className:"pf-u-mr-sm"}),P.formatMessage(V.removeProcessTitle,{count:O?1:a.length})),onClose:S,actions:[u.a.createElement(v.Button,{id:"submit-remove-workflow",key:"submit",variant:"danger",type:"button",isDisabled:b,onClick:function(){return h(!0),j()}},b?u.a.createElement(u.a.Fragment,null,u.a.createElement(de.Spinner,{size:"sm",className:"pf-u-mr-md"}),P.formatMessage(Me.a.deleting)):P.formatMessage(Me.a.delete)),u.a.createElement(v.Button,{id:"cancel-remove-workflow",key:"cancel",variant:"link",type:"button",isDisabled:b,onClick:S},P.formatMessage(Me.a.cancel))]},u.a.createElement(pe.TextContent,null,u.a.createElement(fe.Text,{component:fe.TextVariants.p},x?u.a.createElement(he.c,null):ke()(T())?P.formatMessage(V.removeProcessDescription,{name:F}):P.formatMessage(V.removeProcessDescriptionWithDeps,{name:F,dependenciesList:u.a.createElement("span",{key:"span",className:"pf-u-mt-lg span-block"},T().map((function(e){return u.a.createElement("li",{key:e},e)})))}))))};Oe.propTypes={fetchData:ue.a.func.isRequired,setSelectedWorkflows:ue.a.func.isRequired,ids:ue.a.array};var Pe=Oe,Ee=a(687),je=a(707),Se=a(708),De=function(e){var t=e.group_refs,a=e.id;return u.a.createElement(je.Flex,{key:a,className:"pf-u-mt-sm"},t.map((function(e){var t=e.name,a=e.uuid;return u.a.createElement(Se.FlexItem,{key:a},u.a.createElement(Ee.Label,{className:"group-label pf-u-mb-sm"},t))})))};De.propTypes={id:ue.a.string,group_refs:ue.a.arrayOf(ue.a.shape({name:ue.a.string.isRequired,uuid:ue.a.string.isRequired}))};var Te=function(e){return e.map((function(e){var t=e.id,a=e.name,r=e.description,s=e.sequence,n=e.group_refs;return{id:t,selected:!1,cells:[s,a,r,u.a.createElement(u.a.Fragment,{key:t},u.a.createElement(De,{key:t,group_refs:n,id:t}))]}}))},Fe=a(754),xe=a(149),Ae=a(742),Re=a(38),_e=a(758),qe=a(734),Ce=a(748),Ve=a.n(Ce);function Ne(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ie(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ne(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Le=function(e,t){var a=t.type,r=t.initialValues,s=t.schema;switch(a){case"loaded":return Ie(Ie({},e),{},{initialValues:r,schema:s,isLoading:!1});default:return e}},Be=function(e){var t=e.group_refs.map((function(e){return{label:e.name,value:e.uuid}}));return Ie(Ie({},e),{},{group_refs:t})},We=function(){var e=Object(f.useDispatch)(),t=Object(p.g)().push,a=Object(W.a)(),r=Object(we.a)(["workflow"]),n=o()(r,1)[0].workflow,c=be(n),i=Object(l.useReducer)(Le,{isLoading:!0}),d=o()(i,2),m=d[0],g=m.initialValues,v=m.schema,w=m.isLoading,b=d[1];Object(l.useEffect)((function(){c?b({type:"loaded",initialValues:Be(c),schema:ne(a,c.id)}):A(n).then((function(e){return b({type:"loaded",initialValues:Be(e),schema:ne(a,e.id)})}))}),[]);var h=function(){return t(z.a.workflows.index)};return u.a.createElement(G.Modal,{isOpen:!0,onClose:h,title:a.formatMessage(V.editInformation),description:!w&&a.formatMessage(V.editProcessTitle,{name:g.name}),variant:"small"},w&&u.a.createElement(he.f,null),!w&&u.a.createElement(U.a,{onSubmit:function(t){var r=t.group_refs,s=void 0===r?[]:r,n=B()(t,["group_refs"]);h();var o=Ie(Ie({},n),{},{group_refs:s.map((function(e){return{name:e.label,uuid:e.value}}))});return e(function(e,t){return{type:y.r,payload:(a=e,T.updateWorkflow(a.id,a)),meta:{notifications:{fulfilled:{variant:"success",title:t.formatMessage(V.updateProcessSuccessTitle),description:t.formatMessage(V.updateProcessSuccessDescription)}}}};var a}(o,a)).then((function(){return e(N())}))},onCancel:h,schema:v,initialValues:g,FormTemplate:function(e){return u.a.createElement(Ve.a,s()({},e,{submitLabel:a.formatMessage(Me.a.save),buttonClassName:"pf-u-mt-0",disableSubmit:["validating","pristine"]}))}}))};function Ge(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ze(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ge(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ue=function(e){return[{title:e.formatMessage(V.sequence),transforms:[h.a]},{title:e.formatMessage(qe.a.name),transforms:[h.a]},{title:e.formatMessage($.a.description),transforms:[h.a],cellTransforms:[M.d]},{title:e.formatMessage($.a.groups)}]},Xe=Object(Z.a)((function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.a;return a(!0),t(I(e)),t(N(r)).then((function(){return a(!1)}))}),1e3),Je=function(e,t){return e?[{category:t.formatMessage(qe.a.name),key:"name",chips:[{name:e,value:e}]}]:[]},Qe=function(e,t){switch(t.type){case"setFetching":return ze(ze({},e),{},{isFetching:t.payload});case"setFilterValue":return ze(ze({},e),{},{filterValue:t.payload});case"setFilteringFlag":return ze(ze({},e),{},{isFiltering:t.payload});default:return e}};t.default=function(){var e=Object(l.useState)([]),t=o()(e,2),a=t[0],r=t[1],n=Object(f.useSelector)((function(e){var t=e.workflowReducer;return{workflows:t.workflows,sortBy:t.sortBy,filterValueRedux:t.filterValue}}),f.shallowEqual),c=n.workflows,i=c.data,w=c.meta,h=n.sortBy,M=n.filterValueRedux,k=Object(l.useReducer)(Qe,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{filterValue:e,isOpen:!1,isFetching:!0,isFiltering:!1}}(M)),O=o()(k,2),P=O[0],E=P.filterValue,j=P.isFetching,D=P.isFiltering,T=O[1],F=Object(f.useDispatch)(),x=Object(p.g)(),A=Object(W.a)(),R=function(e){return T({type:"setFetching",payload:!0}),F(N(e)).then((function(){return T({type:"setFetching",payload:!1})})).catch((function(){return T({type:"setFetching",payload:!1})}))};Object(l.useEffect)((function(){R(S.a),Object(Re.g)()}),[]);var _=function(e){T({type:"setFilterValue",payload:e}),Xe(e,F,(function(e){return T({type:"setFilteringFlag",payload:e})}),ze(ze({},w),{},{offset:0}))},q=a.length>0;return u.a.createElement(l.Fragment,null,u.a.createElement(xe.a,null,u.a.createElement(xe.b,{title:A.formatMessage(Me.a.approvalTitle)}),u.a.createElement(Ae.a,null)),u.a.createElement(Fe.a,{sortBy:h,onSort:function(e,t,a,r){var s=r.property;return F(function(e){return{type:y.q,payload:e}}({index:t,direction:a,property:s})),R()},data:i,isSelectable:!0,createRows:Te,columns:Ue(A),fetchData:R,routes:function(){return u.a.createElement(l.Fragment,null,u.a.createElement(p.b,{exact:!0,path:z.a.workflows.add,render:function(e){return u.a.createElement(ie,s()({},e,{postMethod:R}))}}),u.a.createElement(p.b,{exact:!0,path:z.a.workflows.edit,component:We}),u.a.createElement(p.b,{exact:!0,path:z.a.workflows.remove,render:function(e){return u.a.createElement(Pe,s()({},e,{ids:a,fetchData:R,setSelectedWorkflows:r}))}}))},actionResolver:function(){return[{title:A.formatMessage(V.edit),component:"button",onClick:function(e,t,a){return x.push({pathname:z.a.workflows.edit,search:"?workflow=".concat(a.id)})}},{title:A.formatMessage(Me.a.delete),component:"button",onClick:function(e,t,a){return x.push({pathname:z.a.workflows.remove,search:"?workflow=".concat(a.id)})}}]},titlePlural:A.formatMessage(V.approvalProcesses),titleSingular:A.formatMessage(V.approvalProcess),pagination:w,setCheckedItems:function(e){return r(e.map((function(e){return e.id})))},toolbarButtons:function(){return u.a.createElement(m.ToolbarGroup,{className:"pf-u-pl-lg top-toolbar"},u.a.createElement(g.ToolbarItem,null,u.a.createElement(d.b,{id:"add-workflow-link",to:{pathname:z.a.workflows.add}},u.a.createElement(v.Button,{variant:"primary","aria-label":A.formatMessage($.a.create)},A.formatMessage($.a.create)))),u.a.createElement(g.ToolbarItem,null,u.a.createElement(d.b,{id:"remove-multiple-workflows",className:q?"":"disabled-link",to:{pathname:z.a.workflows.remove}},u.a.createElement(v.Button,{variant:"secondary",isDisabled:!q,"aria-label":A.formatMessage(V.deleteApprovalTitle)},A.formatMessage(Me.a.delete)))))},filterValue:E,onFilterChange:_,isLoading:j||D,renderEmptyState:function(){return u.a.createElement(_e.a,{title:""===E?A.formatMessage(V.noApprovalProcesses):A.formatMessage(qe.a.noResultsFound),Icon:b.a,PrimaryAction:function(){return""!==E?u.a.createElement(v.Button,{onClick:function(){return _("")},variant:"link"},A.formatMessage(qe.a.clearAllFilters)):null},description:""===E?A.formatMessage(V.noApprovalProcesses):A.formatMessage(qe.a.clearAllFiltersDescription)})},activeFiltersConfig:{filters:Je(E,A),onDelete:function(){return _("")}}}))}}}]);
//# sourceMappingURL=../sourcemaps/workflows~5a4d8549.js.map